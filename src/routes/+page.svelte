<script lang="ts">
  import { descriptions } from './courseDescriptions';
  
  // èª²ç¨‹è³‡æ–™æ›´æ”¹ç‚ºæ›´å½ˆæ€§çš„çµæ§‹
  const days = [
    { day: '07.01', abbr: 'TUE' },
    { day: '07.02', abbr: 'WED' },
    { day: '07.03', abbr: 'THU' },
    { day: '07.04', abbr: 'FRI' }
  ];
  const schedules = [
    {
      timeRange: { start: '09:00', end: '12:00' },
      title: 'LUNCH TIME',
      courses: [
        [
          { 
            name: 'å ±åˆ° + ç ´å†°', 
            type: 'basic', 
            rowSpan: 1.05,
            description: '----------------------------------------\næ­¡è¿ä¾†åˆ°èª²ç¨‹ï¼é€™å€‹ç’°ç¯€æˆ‘å€‘å°‡é€²è¡Œç ´å†°æ´»å‹•ï¼Œè®“å¤§å®¶äº’ç›¸èªè­˜ã€‚' ,
            gridRow: 'span 1',
            customStyle: 'margin-top: 35px;'
          },
          { 
            name: 'é–‹å¹•', 
            type: 'advanced', 
            rowSpan: 0.5,
            description: '----------------------------------------\nèª²ç¨‹é–‹å¹•å¼ï¼Œä»‹ç´¹èª²ç¨‹ç›®æ¨™èˆ‡å…§å®¹å¤§ç¶±ã€‚' 
          }
        ],
        [{ 
          name: 'ä¸»é¡Œèª²ç¨‹äºŒ\né‚Šç·£äººçš„å¥½æœ‹å‹â€”åœ¨ Discord è·Ÿ AI æ©Ÿå™¨äººèŠå¤©å§ï¼', 
          type: 'project', 
          rowSpan: 2,
          description: '----------------------------------------\nç›¸ä¿¡å¤§å®¶éƒ½æœ‰åœ¨ Discord è·Ÿæœ‹å‹èŠå¤©çš„ç¶“é©—å§ï½\nä»€éº¼ï¼ä½ èªªæ²’æœ‰æœ‹å‹è·Ÿä½ èŠå¤©ï¼Œå¹«ä½  QQğŸ˜¢\nä½†æ˜¯æ²’é—œä¿‚ï¼Œåœ¨é€™å ‚èª²ä½ å¯ä»¥å­¸æœƒæ€éº¼å¯«ä½ çš„ç¬¬ä¸€éš» Discord botã€‚\nç”šè‡³å¯ä»¥é€éä¸²æ¥å¤§å‹èªè¨€æ¨¡å‹ï¼Œ\nå¹«ä½ çš„æ©Ÿå™¨äººæ³¨å…¥éˆé­‚ï¼Œ\né€™æ¨£ä½ å°±æœ‰ä¸€å€‹è·Ÿä½ èŠå¤©çš„æ©Ÿå™¨äººäº†ï½\nå†ä¹Ÿä¸éœ€è¦æ‰¾æœ‹å‹èŠå¤©äº†ã€‚\næœ¬å ‚èª²ç¨‹ä½ å°‡å­¸åˆ°ï¼š\næ•™ä½ å¯«å‡ºç¬¬ä¸€éš» Discord bot\nè¬›è§£ã€ŒéåŒæ­¥è™•ç†ã€çš„æ¦‚å¿µ\nè¬›è§£å¤§å‹èªè¨€æ¨¡å‹èƒŒå¾Œçš„åŸç†\nè¬›è§£ API çš„åŸç†\næ•™ä½ å¦‚ä½•ä½¿ç”¨ Gemini APIï¼Œä¸¦ä¸²æ¥ Discord botï¼Œåœ¨ Discord è£½ä½œ AI èŠå¤©æ©Ÿå™¨äºº' 
        }],
        [{ 
          name: 'ä¸»é¡Œèª²ç¨‹å››\nå¦‚ä½•æ‰“é€ è‡ªå·±çš„éŠæˆ² - Discord Bot çš„é€²éšèªæ³•', 
          type: 'basic', 
          rowSpan: 2,
          description: '----------------------------------------\nç¶“éé›œè²¨åº—ï¼Œä¸ç¶“æ„çš„ä¸€æ’‡ï¼Œç«Ÿç„¶æ˜¯å¤§æ– ğŸ•¹ï¸\nä¾†ç©ç©çœ‹å§ï¼Œè…¦æµ·ä¸è‡ªè¦ºåœ°æµ®ç¾é€™å€‹æƒ³æ³•ã€‚\næ‹‰å¼µå¡‘è† æ¤…ï¼Œæ‰­äº†æ‰­é ­ï¼Œè½‰äº†è½‰æ‰‹...\nä¸€åˆ‡ï¼Œæº–å‚™å°±ç·’ï¼\nã€Œé˜ï¼ã€åå…ƒæŠ•ä¸‹å»...\næ‰‹æŒ‡é£›å¿«çš„åœ¨æŒ‰éµä¹‹é–“é£›æ¢­ã€‚\nã€Œä¸Ÿä¸Ÿä¸Ÿä¸Ÿ...æ‹æ‹...ã€\né¦¬ä¸Šä¾†æ‰“è‡‰æˆ‘çš„ï¼Œæ˜¯å¤§å¤§çš„ã€ŒGAMEOVERã€å­—æ¨£ ğŸ‘¾\nå°ï¼Œæˆ‘åªæ˜¯åœ¨äº‚æŒ‰ ğŸ™ƒ\nå¯æƒ¡...é€™ä¹Ÿå¤ªé›£äº†...\néŠæˆ²æ©Ÿ...æ°£äºº...\nå¦‚æœä½ ä¹Ÿè¦ºå¾—éŠæˆ²æ©Ÿæ°£äººçš„è©±ğŸ˜¡\nä¸å¦¨è©¦è©¦åšè‡ªå·±çš„éŠæˆ²æ©Ÿå™¨äººğŸ¤–\né€™å ‚èª²ï¼Œä½ æœƒå­¸åˆ°ï¼š\nâœ… è€ƒé©—å³æ™‚åæ‡‰çš„ QTE äº‹ä»¶\nâœ… æ¨¡æ“¬ RPG çš„å°è©±ç³»çµ±\nâœ… é¡ä¼¼å¯¶å¯å¤¢çš„å›åˆå°æˆ°\nâ å¥½è¨å­çš„æ„Ÿè¦ºå‘€~~~\næ­¤å¤–ï¼Œæ­¤å¤–ï¼Œæœ¬å ‚èª²å°‡æ¥åˆå‰é¢æ‰€å­¸\nåˆ©ç”¨ AI å¹«ä½ ç”Ÿæˆå±¬æ–¼è‡ªå·±çš„ä¸–ç•Œè§€ ğŸï¸\næˆ‘å€‘å°‡ä¸€æ­¥æ­¥æ‰‹æŠŠæ‰‹æ•™å­¸ï¼Œå¸¶ä½ å¾ä¸æœƒå­¸åˆ°æœƒã€‚\nå› ç‚ºï¼š\nã€Œé›–ç„¶åªæ˜¯éŠæˆ²ï¼Œä½†å¯ä¸æ˜¯é¬§è‘—ç©çš„ã€‚ã€ ' 
        }],
        [{ 
          name: 'é»‘å®¢æ¾', 
          type: 'basic', 
          rowSpan: 2,
          description: '----------------------------------------\né»‘å®¢æ¾å°ˆæ¡ˆé–‹ç™¼æ™‚é–“ã€‚' 
        }]
      ]
    },
    {
      timeRange: { start: '14:00', end: '17:00' },
      title: 'DINNER TIME',
      courses: [
        [{ 
          name: 'PYTHON åŸºç¤', 
          type: 'basic', 
          rowSpan: 2.1,
          description: '----------------------------------------\nä½ æ˜¯ä¸æ˜¯å¸¸å¸¸è½åˆ°ã€ŒPython å¾ˆç°¡å–®ï¼Œé©åˆåˆå­¸è€…ã€ä½†æ‰“é–‹ç¨‹å¼ç·¨è¼¯å™¨é‚„æ˜¯è¦ºå¾—å¥½é™Œç”Ÿï¼Ÿ\nåˆ¥æ“”å¿ƒï¼é€™å ‚èª²å°±æ˜¯ç‚ºäº†ä½ é€™æ¨£çš„ é›¶ç¶“é©—æ–°æ‰‹ è¨­è¨ˆçš„ ğŸš€\nå¾æœ€åŸºæœ¬çš„è¼¸å‡ºã€è®Šæ•¸ã€è¨ˆç®—é–‹å§‹ï¼Œ\nå†ä¸€è·¯å¸¶ä½ ææ‡‚ã€Œä»€éº¼æ˜¯ if åˆ¤æ–·ï¼Ÿfor è·‘ä¾†è·‘å»è¦è·‘å»å“ªï¼Ÿã€\nå­¸å®Œä¹‹å¾Œï¼Œä½ å°±èƒ½ï¼š\nâœ”ï¸ å¯«å‡ºè‡ªå·±çš„å°å·¥å…·\nâœ”ï¸ è·‘è¿´åœˆè·‘å¾—æ¯”å°æ˜é‚„å¿«\nâœ”ï¸ å’Œåˆ¥äººèªªã€Œæˆ‘æœƒ Python å–”ï¼ã€\næˆ‘å€‘é‚„æœƒé€éå¯¦éš›çš„ å°ç·´ç¿’ & æœ‰è¶£ç¯„ä¾‹ï¼Œè®“ä½ ä¸åªæ˜¯æœƒçœ‹ï¼Œä¹ŸçœŸçš„å¯«å¾—å‡ºä¾†ï½\nåˆ¥æ“”å¿ƒçœ‹ä¸æ‡‚ã€ä¸æ•¢å•ï¼Œé€™å ‚èª²å°±æ˜¯ä½ çš„ ç¨‹å¼å•Ÿè’™èµ·é»ï¼' 
        }],
        [
          { 
            name: 'é¸ä¿®èª²ä¸€', 
            type: 'basic', 
            rowSpan: 1,
            description: descriptions.course1 
          },
          { 
            name: 'ä¸»é¡Œèª²ç¨‹ä¸‰\næ“æœ‰è‡ªå·±çš„ç”·å¥³æœ‹å‹ - Discord bot AI ç”Ÿåœ–', 
            type: 'basic', 
            rowSpan: 1,
            description: '----------------------------------------\nã€Œã„Ÿã„Ÿï¼Œè½èªªæ¯æœˆçš„ 14 è™Ÿéƒ½æ˜¯æƒ…äººç¯€è¯¶æ¬¸ã€‚1 æœˆæ˜¯æ—¥è¨˜æƒ…äººç¯€ï¼Œ2 æœˆæ˜¯è¥¿æ´‹æƒ…äººç¯€ï¼Œ3 æœˆæ˜¯ç™½è‰²æƒ…äººç¯€......ã€ã€Œå¤ äº†ï¼Œåˆ¥èªªäº†ã€‚å—šå—šå—š......ã€\næ¯æœˆçš„æƒ…äººç¯€éƒ½æ˜¯è‡ªå·±éæˆ–æ˜¯æƒ…äººç¯€æƒ³å¢åŠ ä¸€äº›æ¨‚è¶£å—ï¼ŸDiscord bot ä¾†å¹«å¿™ !!!\næœ¬å ‚èª²ä½ å°‡å­¸åˆ°ï¼š\nâœ…åœ¨ Discord ä¸­ï¼Œåˆ©ç”¨ Discord bot å‚³é€åœ–ç‰‡\nâœ…å°‡ Discord bot æ­é… AIï¼Œä½¿å…¶èƒ½å¤ åœ¨ Discord ä¸­ç”Ÿåœ–\nâœ…ç¶²é æ¡†æ¶ Flask\nâœ…å…§ç¶²ç©¿é€ ngrok\nâœ…diffuserï¼ˆåœ–ç‰‡ç”Ÿæˆå¼AI)' 
          }
        ],
        [
          { 
            name: 'é¸ä¿®èª²äºŒ', 
            type: 'basic', 
            rowSpan: 1,
            description: descriptions.course2  
          },
          { 
            name: 'æ´»å‹•ä¸‰', 
            type: 'basic', 
            rowSpan: 1,
            description: '----------------------------------------\næ•¬è«‹æœŸå¾…ï¼ğŸ¥°' 
          }
        ],
        [
          { 
            name: 'é»‘å®¢æ¾å ±å‘Š', 
            type: 'basic', 
            rowSpan: 1.3,
            description: '----------------------------------------\nå„çµ„å±•ç¤ºé»‘å®¢æ¾å°ˆæ¡ˆæˆæœï¼Œè¬›å¸«æä¾›å›é¥‹ã€‚' 
          },
          { 
            name: 'é–‰å¹•', 
            type: 'basic', 
            rowSpan: 0.7,
            description: '----------------------------------------\nèª²ç¨‹ç¸½çµèˆ‡çµæ¥­å¼ï¼Œé ’ç™¼è­‰æ›¸èˆ‡åˆå½±ã€‚' 
          }
        ]
      ]
    },
    {
      timeRange: { start: '19:00', end: '21:00' },
      title: 'CODING/SLEEPING TIME',
      courses: [
        [
          { 
            name: 'æ´»å‹•ä¸€', 
            type: 'basic', 
            rowSpan: 2,
            description: '----------------------------------------\næ•¬è«‹æœŸå¾…ï¼ğŸ¥³' 
          }
        ],
        [{ 
          name: 'æ´»å‹•äºŒ', 
          type: 'basic', 
          rowSpan: 2,
          description: '----------------------------------------\næ•¬è«‹æœŸå¾…ï¼ğŸ¤©' 
        }],
        [{ 
          name: 'é»‘å®¢æ¾', 
          type: 'basic', 
          rowSpan: 2,
          description: '----------------------------------------\né»‘å®¢æ¾å°ˆæ¡ˆé–‹ç™¼æ™‚é–“'
        }]
      ]
    }
  ];

  // ç”¨æ–¼æ§åˆ¶å½ˆå‡ºè¦–çª—
  let showModal = false;
  let selectedCourse: {
    name: string;
    type: string;
    rowSpan: number;
    description: string;
  } | null = null;

  // Handling errors
  let loadError = false;
  
  // Function to handle image load error
  function handleImageError() {
    loadError = true;
    console.error("Failed to load image");
  }
  
  // Close modal function
  function closeModal() {
    showModal = false;
    selectedCourse = null;
  }
  
  // Add keyboard event listener for ESC key
  function handleKeydown(event: KeyboardEvent) {
    if (event.key === 'Escape' && showModal) {
      closeModal();
    }
  }
</script>

<svelte:window on:keydown={handleKeydown} />

<section class="container mx-auto text-white min-w-[720px]">
  <div class="mt-3 mb-3">
    <span class="text-white text-4xl font-[Cubic 11]">èª²ç¨‹ä»‹ç´¹</span>
  </div>
  
  <div class="bg-black/40 border-3 border-white p-5 relative">
    <!-- ä½¿ç”¨çµ•å°å®šä½æ”¾ç½®è˜‘è‡åœ–ç‰‡ -->
    <div class="absolute top-2 left-15">
      {#if !loadError}
        <img src="src\routes\material-5.PNG" alt="Camp mascot" class="mushroom" on:error={handleImageError} />
      {:else}
        <div class="mushroom bg-gray-600 flex items-center justify-center">
          <span class="text-xs">åœ–ç‰‡è¼‰å…¥å¤±æ•—</span>
        </div>
      {/if}
    </div>
    
    <!-- Consistent grid layout with precise widths and more spacing -->
    <div class="flex">
      <!-- Time column placeholder with exact width -->
      <div class="w-[150px] mr-6"></div>
      
      <!-- Day headers grid with fixed column widths -->
      <div class="grid grid-cols-4 gap-2 mb-4 w-[calc(100%-190px)]">
        {#each days as { day, abbr }, i}
          <div class="bg-gray-300 text-black p-3 text-center font-[Cubic 11] text-xl w-full">
            {day} ({abbr})
          </div>
        {/each}
      </div>
    </div>

    <!-- Course schedules with matching grid layout -->
    {#each schedules as schedule, scheduleIndex}
      <div class="flex mb-4 gap-6">
        <!-- Time column with exact same width as placeholder -->
        <div class="bg-gray-300 text-black p-3 flex flex-col justify-between items-center font-[Cubic 11] text-xl w-[150px] min-h-[200px]">
          <div>{schedule.timeRange.start}</div>
          <div class="font-bold">|</div>
          <div>{schedule.timeRange.end}</div>
        </div>

        <!-- Course slots using same width calculation -->
        <div class="grid grid-cols-4 gap-2 w-[calc(100%-190px)]" style="grid-auto-rows: 95px;">
          {#each schedule.courses as daySlots, dayIndex}
            <div class="flex flex-col gap-2 w-full">
              {#each daySlots as course, courseIndex}
                <button 
                  class="course-button border-3 border-white p-4 text-center flex items-center justify-center font-[Cubic 11] text-xl bg-transparent hover:bg-[#f1cc10] cursor-pointer transition-colors w-full {course.name.length < 5 ? 'short-text' : ''}"
                  style="grid-row: {course.gridRow || 'auto'}; min-height: {course.rowSpan * 95}px; {course.customStyle || ''};"
                  on:click={() => {
                    selectedCourse = course;
                    showModal = true;
                  }}
                  on:keydown={(e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                      selectedCourse = course;
                      showModal = true;
                    }
                  }}
                  aria-label={`View details for ${course.name}`}
                >
                  <div class="course-content">
                    {course.name}
                  </div>
                </button>
              {/each}
            </div>
          {/each}
        </div>
      </div>

      <!-- Break time label -->
      {#if scheduleIndex === 0}
        <!-- For LUNCH TIME and DINNER TIME - full width with all 4 days -->
        <div class="bg-gray-300 text-black p-3 text-center mb-5 font-[Cubic 11] text-2xl w-full">
          {schedule.title}
        </div>
      {:else if scheduleIndex === 2 || (scheduleIndex === 1)}
        <!-- For CODING/SLEEPING TIME - not for day 4 -->
        <div class="flex mb-5">
          <div class="bg-gray-300 text-black p-3 text-center font-[Cubic 11] text-2xl w-[calc(77.5%)]">
            {schedule.title}
          </div>
        </div>
      {/if}
    {/each}
  </div>
</section>

<!-- æ–°é¢¨æ ¼å½ˆå‡ºè¦–çª— -->
{#if showModal && selectedCourse}
  <div class="modal-overlay" style="display: flex;" on:click|self={closeModal}>
    <div class="modal">
      <span class="close-btn" on:click={closeModal}>Ã—</span>
      <h2>{selectedCourse.name}</h2>
      <p>{selectedCourse.description}</p>
    </div>
  </div>
{/if}

<style>
  :global(body) {
    margin: 0;
    padding: 0;
    background-color: #000;
    color: white;
  }

  /* Custom font usage */
  @font-face {
    font-family: 'Cubic 11';
    src: url('/fonts/Cubic11.woff2') format('woff2'),
         url('/fonts/Cubic11.woff') format('woff');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  /* Custom image for mushroom */
  .mushroom {
    width: 80px;
    height: 80px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  /* Fix for border-3 in Tailwind */
  .border-3 {
    border-width: 3px !important;
  }

  /* Add the custom left-15 class */
  .left-15 {
    left: 3.75rem;
  }

  /* æ–‡å­—å®¹å™¨æ¨£å¼ - ä¸å†ä½¿ç”¨æ¼¸æ·¡æ•ˆæœ */
  .course-button {
    position: relative;
    overflow: hidden;
    white-space: pre-line;
  }

  .course-content {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 1rem;
  }

  /* æ˜Ÿç©ºé¢¨æ ¼å½ˆå‡ºè¦–çª— */
  .modal-overlay { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background-color: rgba(0, 0, 0, 0.7);
    display: none; 
    align-items: center; 
    justify-content: center; 
    z-index: 10; 
  } 
  
  .modal {
    background: #111;
    color: #fff;
    padding: 30px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh; /* é™åˆ¶è¦–çª—çš„æœ€å¤§é«˜åº¦ç‚ºè¦–çª—é«˜åº¦çš„ 80% */
    overflow-y: auto; /* ç•¶å…§å®¹è¶…å‡ºé«˜åº¦æ™‚é¡¯ç¤ºå‚ç›´æ»¾å‹•æ¢ */
    border: 3px solid white;
    box-shadow: 0 0 10px white;
    text-align: left;
    position: relative;
    font-family: 'Cubic 11', monospace;
    image-rendering: pixelated;
    white-space: pre-line;
  }

  .modal h2 {
    font-size: 20px;
    margin-bottom: 20px;
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  .modal p {
    font-size: 16px;
    line-height: 1.8;
  }

  .close-btn {
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 20px;
    cursor: pointer;
  }
</style>